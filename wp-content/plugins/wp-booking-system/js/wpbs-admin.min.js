function wpbs_htmlEscape(a){return String(a).replace(/&/g,"--AMP--").replace(/"/g,"--DOUBLEQUOTE--").replace(/'/g,"--QUOTE--").replace(/</g,"--LT--").replace(/>/g,"--GT--")}function showLoader(){wpbs(".wpbs-loading").fadeTo(0,0).css("display","block").fadeTo(200,1),wpbs(".wpbs-calendar ul").animate({opacity:"0.7"},200)}function hideLoader(){wpbs(".wpbs-loading").css("display","none")}function wpbs_changeDay(a,s){var t={action:"wpbs_changeDayAdmin",calendarDirection:a,totalCalendars:$instance.find(".wpbs-total-calendars").html(),currentTimestamp:s,calendarData:$instance.find(".wpbs-calendar-data").attr("data-info"),calendarHistory:$instance.find(".wpbs-calendar-history").html(),calendarLegend:$instance.find(".wpbs-calendar-legend").attr("data-info"),showDropdown:$instance.find(".wpbs-show-dropdown").html(),autoPending:$instance.find(".wpbs-calendar-auto-pending").html(),weekNumbers:$instance.find(".wpbs-calendar-week-numbers").html(),calendarSelectionType:$instance.find(".wpbs-calendar-selection-type").html(),calendarLanguage:$instance.find(".wpbs-calendar-language").html(),weekStart:$instance.find(".wpbs-calendar-week-start").html(),calendarID:$instance.find(".wpbs-calendar-ID").html()};wpbs.post(ajaxurl,t,function(a){$instance.find(".wpbs-calendars").html(a),hideLoader(),wpbs(".wpbs-dropdown").customSelect(),wpbs(".wpbs-chosen").chosen()})}function wpbs_select_text(a){if(document.selection){var s=document.body.createTextRange();s.moveToElementText(a),s.select()}else if(window.getSelection){var s=document.createRange();s.selectNode(a),window.getSelection().addRange(s)}}var wpbs=jQuery.noConflict(),$instance;wpbs(document).ready(function(){wpbs(".wpbs-chosen").chosen(),wpbs(".wpbs-wrap .meta-box-sortables").sortable({disabled:!0}),wpbs(".wpbs-dropdown").customSelect(),wpbs(".wpbs-container").each(function(){$instance=wpbs(this),wpbs($instance).on("change",".wpbs-dropdown",function(a){showLoader(),a.preventDefault(),wpbs_changeDay("jump",wpbs(this).val())}),wpbs($instance).on("click",".wpbs-prev",function(a){showLoader(),a.preventDefault(),0==$instance.find(".wpbs-current-timestamp a").length?timestamp=$instance.find(".wpbs-current-timestamp").html():timestamp=$instance.find(".wpbs-current-timestamp a").html(),wpbs_changeDay("prev",timestamp)}),wpbs($instance).on("click",".wpbs-next",function(a){showLoader(),a.preventDefault(),0==$instance.find(".wpbs-current-timestamp a").length?timestamp=$instance.find(".wpbs-current-timestamp").html():timestamp=$instance.find(".wpbs-current-timestamp a").html(),wpbs_changeDay("next",timestamp)})}),wpbs(document).on("click","#calendarBatchUpdate",function(a){a.preventDefault();var s=JSON.parse(wpbs(".wpbs-calendar-data").attr("data-info"));s||(s={});var t=wpbs(".wpbs-current-timestamp").html(),e=new Date(1e3*t),p=wpbs("#startDay").val(),n=wpbs("#startMonth").val(),l=wpbs("#startYear").val(),d=wpbs("#endDay").val(),b=wpbs("#endMonth").val(),w=wpbs("#endYear").val(),r=wpbs("#changeStatus").val(),o=wpbs("#bookingDetails").val(),c=Date.parse(p+" "+n+" "+l)/1e3,m=Date.parse(d+" "+b+" "+w)/1e3;if(c<m)for(i=c;i<=m+82800;i+=86400){var u=new Date(1e3*i);u.getMonth()==e.getMonth()&&u.getFullYear()==e.getFullYear()&&(wpbs("select.wpbs-day-"+u.getDate()).find("option.wpbs-option-"+r).prop("selected")||(wpbs("select.wpbs-day-"+u.getDate()).find("option").prop("selected",!1),wpbs("select.wpbs-day-"+u.getDate()).find("option.wpbs-option-"+r).prop("selected",!0)),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-select-status").removeClass().addClass("wpbs-select-status status-"+r),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+r),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find("span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+r),wpbs("select.wpbs-day-"+u.getDate()).parents("li").find(".wpbs-input-description").val(o),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()).removeClass().addClass("wpbs-day wpbs-day-"+u.getDate()+" status-"+r),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()+" span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+r),wpbs(".wpbs-calendars li.wpbs-day-"+u.getDate()+" span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+r));var y="year"+u.getFullYear(),h="month"+(u.getMonth()+1),f="day"+u.getDate(),t=wpbs(".wpbs-current-timestamp").html(),e=new Date(1e3*t),h=u.getMonth()+1,y=u.getFullYear(),f=u.getDate();y in s||(s[y]={}),h in s[y]||(s[y][h]={}),s[y][h][f]=r,s[y][h]["description-"+f]=o,wpbs("span.error").css("display","none")}else wpbs("span.error").css("display","block");wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(s)),wpbs("#inputCalendarData").val(JSON.stringify(s))}),wpbs(document).on("change",".wpbs-day-select",function(a){var s=JSON.parse(wpbs(".wpbs-calendar-data").attr("data-info"));s||(s={});var t=wpbs(".wpbs-current-timestamp").html(),e=(new Date(1e3*t),wpbs(this).attr("data-month").replace("wpbs-month-","")),p=wpbs(this).attr("data-year").replace("wpbs-year-",""),n=wpbs(this).attr("data-name").replace("wpbs-day-",""),i=wpbs(this).val();p in s||(s[p]={}),e in s[p]||(s[p][e]={}),s[p][e][n]=i,wpbs(this).parent().find("span.wpbs-select-status").removeClass().addClass("wpbs-select-status status-"+i),wpbs(this).parent().find("span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+i),wpbs(this).parent().find("span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+i),0==wpbs(this).parents(".wpbs-modal-box").length&&(wpbs(".wpbs-calendar li.wpbs-day-"+n).removeClass().addClass("wpbs-day wpbs-day-"+n+" status-"+i),wpbs(".wpbs-calendar li.wpbs-day-"+n+" span.wpbs-day-split-top").removeClass().addClass("wpbs-day-split-top wpbs-day-split-top-"+i),wpbs(".wpbs-calendar li.wpbs-day-"+n+" span.wpbs-day-split-bottom").removeClass().addClass("wpbs-day-split-bottom wpbs-day-split-bottom-"+i)),wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(s)),wpbs("#inputCalendarData").val(JSON.stringify(s))}),wpbs(document).on("keyup",".wpbs-input-description",function(a){var s=JSON.parse(wpbs(".wpbs-calendar-data").attr("data-info"));s||(s={});var t=wpbs(".wpbs-current-timestamp").html(),e=(new Date(1e3*t),wpbs(this).attr("data-month").replace("wpbs-month-","")),p=wpbs(this).attr("data-year").replace("wpbs-year-",""),n=wpbs(this).attr("data-name").replace("wpbs-day-",""),i=wpbs(this).val();p in s||(s[p]={}),e in s[p]||(s[p][e]={}),s[p][e]["description-"+n]=wpbs_htmlEscape(i),wpbs(".wpbs-calendar-data").attr("data-info",JSON.stringify(s)),wpbs("#inputCalendarData").val(JSON.stringify(s))}),wpbs(".saveCalendar").click(function(){return!!wpbs.trim(wpbs(".fullTitle").val()).length||(wpbs(".fullTitle").addClass("error").focus(),!1)}),wpbs(document).on("click",".bulk-edit-legend-apply",function(){wpbs(".edit-dates-popup select").each(function(){wpbs(this).val(wpbs(".bulk-edit-legend-select").val()).trigger("change")}),wpbs(".edit-dates-popup input").each(function(){wpbs(this).val(wpbs(".bulk-edit-legend-text").val()).trigger("keyup")})})});